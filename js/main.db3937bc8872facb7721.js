!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";function i(t,e){return new s(t,e)}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.itsRow=e,this.itsColumn=n}return r(t,[{key:"toString",value:function(){return this.row+","+this.column}},{key:"equals",value:function(t){return t.itsColumn===this.itsColumn&&t.itsRow===this.itsRow}},{key:"neighbour",value:function(t){return"u"===t?i(this.row-1,this.column):"d"===t?i(this.row+1,this.column):"l"===t?i(this.row,this.column-1):"r"===t?i(this.row,this.column+1):void 0}},{key:"row",get:function(){return this.itsRow}},{key:"column",get:function(){return this.itsColumn}}]),t}();e.Position=s,e.pos=i},function(t,e,n){n(2),t.exports=n(9)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3);window.document.addEventListener("DOMContentLoaded",function(t){new i.default(window,t.target).init()})},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),s=n(7),o=n(8),a=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maps=[],this.window=e,this.document=n,this.painter=new o.default(this.document.getElementById("game"))}return i(t,[{key:"init",value:function(){this.initMaps(),this.generateLinks(),this.game=r.default.start(this.maps[2],r.default.randomPillPlacer),this.window.setInterval(this.heartbeat.bind(this),175),this.document.body.addEventListener("keydown",this.onKeyDown.bind(this))}},{key:"onKeyDown",value:function(t){var e={37:"l",38:"u",39:"r",40:"d",87:"u",65:"l",83:"d",68:"r"}[t.keyCode];e&&(this.game.turn(e),t.preventDefault())}},{key:"heartbeat",value:function(){this.game.step(),this.painter.paint(this.game)}},{key:"initMaps",value:function(){for(var t=this.document.getElementsByClassName("map"),e=0;e<t.length;++e)this.maps.push(new s.default(t.item(e).innerHTML.trim().split(/\s+/)))}},{key:"generateLinks",value:function(){var t=this,e=this.document.getElementById("chooser");this.maps.forEach(function(n){var i=document.createElement("a");i.setAttribute("href","#"),i.innerHTML="Map",i.addEventListener("click",function(){t.game=r.default.start(n,r.default.randomPillPlacer)}),e.appendChild(i)})}}]),t}();e.default=a},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),s=n(5),o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.itsState=e,this.pillPlacer=n}return i(t,null,[{key:"start",value:function(e,n){return new t(s.default.init(e,null),n)}},{key:"randomPillPlacer",value:function(t){var e=function(t){return Math.floor(Math.random()*t)+1};return r.pos(e(t.map.height),e(t.map.width))}}]),i(t,[{key:"isFree",value:function(t){return"x"!==this.itsState.map.cell(t)&&void 0===this.itsState.snake.positions.find(function(e){return e.equals(t)})}},{key:"step",value:function(){if(this.end)return this;var t=this.itsState.turns,e=0===t.length?this.itsState.direction:t[0],n=this.snake.head.neighbour(e),i=!(this.isFree(n)||this.itsState.snake.tail.equals(n)&&0===this.itsState.growth);0===n.row&&(n=r.pos(this.map.height,n.column)),this.map.height+1===n.row&&(n=r.pos(1,n.column)),0===n.column&&(n=r.pos(n.row,this.map.width)),this.map.width+1===n.column&&(n=r.pos(n.row,1));for(var s=this.itsState.pill&&this.itsState.pill.equals(n)?this.itsState.growth+3:this.itsState.growth,o=i?this.itsState.snake:0===s?this.itsState.snake.move(n):this.itsState.snake.grow(n),a=null===this.pill||this.itsState.pill.equals(n)?this.pillPlacer(this):this.pill;!this.isFree(a);)a=this.pillPlacer(this);return this.itsState=this.itsState.transform({direction:e,snake:o,growth:Math.max(0,s-1),turns:this.itsState.turns.slice(1),end:i,pill:a}),this}},{key:"turn",value:function(t){return t===this.itsState.turns.pop()||this.opposite(t)?this:(this.itsState=this.itsState.transform({direction:this.itsState.direction,snake:this.itsState.snake,growth:this.itsState.growth,turns:this.itsState.turns.concat([t]),end:this.itsState.end,pill:this.itsState.pill}),this)}},{key:"opposite",value:function(t){var e=0===this.itsState.turns.length?this.direction:this.itsState.turns.pop();return"l"===t&&"r"===e||"r"===t&&"l"===e||"u"===t&&"d"===e||"d"===t&&"u"===e}},{key:"snake",get:function(){return this.itsState.snake}},{key:"map",get:function(){return this.itsState.map}},{key:"direction",get:function(){return this.itsState.direction}},{key:"growth",get:function(){return this.itsState.growth}},{key:"end",get:function(){return this.itsState.end}},{key:"pill",get:function(){return this.itsState.pill}}]),t}();e.default=o},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),s=function(){function t(e,n,i,r,s,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.itsMap=e,this.itsSnake=n,this.itsDirection=i,this.itsGrowth=r,this.itsTurns=s,this.itsEnd=o,this.itsPill=a}return i(t,null,[{key:"init",value:function(e,n){return new t(e,new r.Snake([e.startingPosition]),e.startingDirection,4,[],!1,n)}}]),i(t,[{key:"transform",value:function(e){return new t(this.itsMap,e.snake,e.direction,e.growth,e.turns,e.end,e.pill)}},{key:"map",get:function(){return this.itsMap}},{key:"snake",get:function(){return this.itsSnake}},{key:"growth",get:function(){return this.itsGrowth}},{key:"direction",get:function(){return this.itsDirection}},{key:"turns",get:function(){return[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this.itsTurns))}},{key:"end",get:function(){return this.itsEnd}},{key:"pill",get:function(){return this.itsPill}}]),t}();e.default=s},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.itsPositions=e}return r(t,[{key:"equals",value:function(t){if(t.itsPositions.length!==this.itsPositions.length)return!1;var e=!0;return this.itsPositions.forEach(function(n,i){n.equals(t.itsPositions[i])||(e=!1)}),e}},{key:"grow",value:function(e){var n=[].concat(i(this.itsPositions));return n.push(e),new t(n)}},{key:"move",value:function(e){var n=this.itsPositions.slice(1);return n.push(e),new t(n)}},{key:"length",get:function(){return this.itsPositions.length}},{key:"head",get:function(){return[].concat(i(this.itsPositions)).pop()}},{key:"tail",get:function(){return this.itsPositions[0]}},{key:"positions",get:function(){return[].concat(i(this.itsPositions))}}]),t}();e.Snake=s},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),s=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cells=new Map,this.itsHeight=e.length,this.itsWidth=e[0].length,e.forEach(function(t,e){if(n.itsWidth!==t.length)throw new Error("Invalid map format");t.split("").forEach(function(t,i){var s=r.pos(e+1,i+1);"X"!==t?(void 0!==["u","d","l","r"].find(function(e){return t===e})&&(n.itsStartingPosition=s,n.itsStartingDirection=t),n.cells.set(s.toString()," ")):n.cells.set(s.toString(),"x")})})}return i(t,[{key:"cell",value:function(t){return this.cells.get(t.toString())}},{key:"height",get:function(){return this.itsHeight}},{key:"width",get:function(){return this.itsWidth}},{key:"startingPosition",get:function(){return this.itsStartingPosition}},{key:"startingDirection",get:function(){return this.itsStartingDirection}}]),t}();e.default=s},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.setAttribute("width","2400"),e.setAttribute("height","2400"),this.context=e.getContext("2d")}return i(t,[{key:"paint",value:function(t){this.paintMap(t),this.paintPill(t),this.paintSnake(t)}},{key:"paintMap",value:function(t){for(var e=1;e<=t.map.height;++e)for(var n=1;n<=t.map.width;++n)this.context.fillStyle="x"===t.map.cell(r.pos(e,n))?"#900":"#000",this.context.fillRect(100*(n-1),100*(e-1),100,100)}},{key:"paintPill",value:function(t){t.pill&&(this.context.fillStyle="#199",this.context.arc(100*(t.pill.column-1)+50,100*(t.pill.row-1)+50,30,0,2*Math.PI),this.context.fill())}},{key:"paintSnake",value:function(t){var e=this;this.context.fillStyle="#191",t.snake.positions.forEach(function(n){e.context.beginPath(),e.context.arc(100*(n.column-1)+50,100*(n.row-1)+50,t.snake.head.equals(n)?38:45,0,2*Math.PI),e.context.fill()})}}]),t}();e.default=s},function(t,e){}]);